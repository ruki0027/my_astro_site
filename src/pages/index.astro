---
import Layout from '../layouts/Layout.astro'
import fs from 'node:fs'
import path from 'node:path'
import matter from 'gray-matter'
import { marked } from 'marked'

import AdSlot from '../components/AdSlot.astro'
import YouTubeEmbed from '../components/YouTubeEmbed.astro'
import HeroPanel from '../components/HeroPanel.astro'

// è®€å– log è³‡æ–™å¤¾ï¼Œå–æœ€æ–°ä¸€ç¯‡
const logDir = path.resolve('./src/content/log')
const files = fs.readdirSync(logDir)
  .filter(f => f.endsWith('.md'))

const logs = files.map(file => {
  const raw = fs.readFileSync(path.join(logDir, file), 'utf-8')
  const { data, content } = matter(raw)
  return {
    ...data,
    content,
    filename: file.replace('.md', ''),
    date: new Date(data.date)
  }
}).sort((a, b) => b.date - a.date)

const latestLog = logs[0]
const formattedDate = latestLog?.date?.toLocaleDateString('zh-TW', {
  year: 'numeric', month: 'long', day: 'numeric', weekday: 'short'
})

// å¯é¸ï¼šæ“·å–å‰ 160 å­—ç•¶æ‘˜è¦ï¼ˆç§»é™¤ md æ¨™è¨˜çš„ç²—åˆ‡ç‰ˆï¼‰
const plain = latestLog ? latestLog.content.replace(/[#>*_`]/g, '').trim() : ''
const excerpt = plain.length > 160 ? plain.slice(0, 160) + 'â€¦' : plain

// ä½ çš„æœ€æ–°å½±ç‰‡ï¼ˆå…ˆæ”¾ä½”ä½ï¼Œä¹‹å¾Œæ›ï¼‰
const LATEST_VIDEO_ID = 'dQw4w9WgXcQ'
---

<Layout>
  <!-- é ‚éƒ¨å»£å‘Šä½ï¼ˆå¯©æ ¸/æœ¬åœ°å¯å…ˆé—œæ‰ PUBLIC_ADSENSE_CLIENTï¼‰ -->
  <AdSlot style="display:block; min-height:120px;" format="auto" />

  <main>
    <h1>ä½ å¥½ï¼Œæ­¡è¿ä¾†åˆ°æˆ‘çš„ä¸–ç•Œ</h1>
    <p>é€™è£¡æ˜¯æˆ‘å€‹äººçš„å‰µä½œç©ºé–“ï¼Œè¨˜éŒ„æˆ‘çš„å°ˆæ¡ˆèˆ‡æƒ³æ³•ã€‚</p>

    <section class="grid">
      <section>
        <h2>æ”¾å€‹å½¢è±¡åœ–</h2>
        <div class="display-box">
          <img src="/images/demo.jpg" alt="å±•ç¤ºåœ–ç‰‡" />
        </div>
      </section>
      <style>
        .display-box img {
          max-width: 100%;
          height: auto;
          object-fit: contain;
        }

        .display-box {
          height: 300px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: #fff;
          overflow: hidden;
        }
      </style>

      <div class="card">
        <h2>æœ€æ–°å½±ç‰‡</h2>
        <YouTubeEmbed id={LATEST_VIDEO_ID} title="My Pet æœ€æ–°å±•ç¤º" />
        <p class="muted" style="margin-top:8px">ç›®å‰é‚„æ²’æœ‰å½±ç‰‡å…ˆä¾†å€‹ç‘å…‹æ–ã€‚</p>
      </div>
    </section>

    <section class="latest-log card" style="margin-top:24px">
      <h2>ğŸ“° æœ€æ–°æ—¥èªŒ</h2>
      {latestLog ? (
        <>
          <p>
            <a href={`/log/${latestLog.filename}`}>{latestLog.title}</a>
          </p>
          <p class="log-date">{formattedDate}</p>
          {excerpt && <p class="muted">{excerpt} <a href={`/log/${latestLog.filename}`}>ç¹¼çºŒé–±è®€</a></p>}
        </>
      ) : (
        <p class="muted">é‚„æ²’æœ‰æ—¥èªŒå–”ï¼Œç­‰ç­‰å†ä¾†çœ‹çœ‹ (ï¼w-)</p>
      )}
    </section>

    <section class="fun-intro">
      <p>(à¸‡ â€¢Ì€_â€¢Ì)à¸‡ ã€Œå˜¿ï¼Œä½ çµ‚æ–¼ä¾†äº†ï¼é€™ç«™ç›®å‰é‚„æœ‰é»ç©ºï¼Œä½†æˆ‘å€‘æœƒæ…¢æ…¢è“‹èµ·ä¾†çš„ï½ã€</p>
      
    </section>
  </main>

  <!-- åº•éƒ¨å»£å‘Šä½ -->
  <div style="margin-top:24px">
    <AdSlot style="display:block; min-height:120px;" format="auto" />
  </div>

  <footer class="footer">
    <hr />
    <p style="text-align: center; font-size: 0.8rem; margin-top: 1rem;">
      ğŸ¾ æœ¬ç«™ç‚ºå€‹äººä½œå“å±•ç¤ºèˆ‡å‰µä½œåŸºåœ°ï½œæ‰€æœ‰å…§å®¹ä»åœ¨å»ºè¨­ä¸­
    </p>
    <p style="text-align: center; font-size: 0.7rem;">By é›¶ä¸€</p>
  </footer>
</Layout>
