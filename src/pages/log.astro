---
import Layout from '../layouts/Layout.astro'
import fs from 'node:fs'
import path from 'node:path'
import matter from 'gray-matter'
import { marked } from 'marked'

// 讀取 md 檔案資料夾
const logDir = path.resolve('./src/content/log')
const files = fs.readdirSync(logDir)

// 把每個檔案處理成 { title, date, html } 格式
const logs = files.map(file => {
  const raw = fs.readFileSync(path.join(logDir, file), 'utf-8')
  const { data, content } = matter(raw)
  const html = marked(content)
  return {
    ...data,
    html,
    filename: file.replace('.md', '')
  }
}).sort((a, b) => new Date(b.date) - new Date(a.date))  // 新的在上
---

<Layout>
  <main>
    <h1>更新日誌</h1>
    {logs.map(log => (
      <article class="log-entry">
        <h2><a href={`/log/${log.filename}`}>{log.title}</a></h2>
        <p class="date">
          {
            new Date(log.date).toLocaleDateString('zh-TW', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
              weekday: 'short'
            })
          }
        </p>

        <div innerHTML={log.html}></div>
        <hr />
      </article>
    ))}
  </main>
</Layout>
